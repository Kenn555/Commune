{% extends "base.html" %}
{% block article %}
{% load humanize %}
{% load i18n %}

<div class="flex flex-initial flex-col">
    <div class="flex flex-row max-md:flex-wrap rounded-t-3xl px-5 py-4 min-h-80 gap-4
    {% if person.gender == 'M' %}{% if person.is_alive %} bg-blue-200 {% else %} bg-gray-300 hover:bg-blue-200 {% endif %}{% else %}{% if person.is_alive %} bg-rose-200 {% else %} bg-gray-300 hover:bg-rose-200 {% endif %}{% endif %}
    ">
        <div class="flex flex-col w-full justify-end gap-4 pt-12">
            <div class="text-6xl max-xl:text-5xl max-lg:text-4xl font-bold">
                {{ person.full_name }}
            </div>
            <div class="flex max-md:flex-wrap gap-4">
                <div class="flex flex-col gap-2 w-full">
                    <div class="flex flex-wrap ml-5 gap-x-7 gap-y-2 w-full">
                        {% if person.birthday %}
                        <p><b>{% trans 'birthday'|capfirst %} :</b> {{ person.birthday|date:'d-m-Y H:i' }}</p>
                        {% endif %}
                        {% if person.birth_place %}
                        <p><b>{% trans 'at'|capfirst %} :</b> {{ person.birth_place }}</p>
                        {% endif %}
                        {% if person.carreer %}
                        <p><b>{% trans 'carreer'|capfirst %} :</b> {{ person.carreer }}</p>
                        {% endif %}
                        {% if person.address %}
                        <p><b>{% trans 'address'|capfirst %} :</b> {{ person.address }}</p>
                        {% endif %}
                        {% if birth_certificate.fokotany %}
                        <p><b>{% trans 'fokotany'|capfirst %} :</b> {{ birth_certificate.fokotany.name|title }}</p>
                        {% endif %}
                    </div>
                    <div class="flex flex-row  flex-wrap gap-x-10 gap-y-4 w-full">
                        {% if birth_certificate.father %}
                        <div class="flex flex-col">
                            <a 
                            href="{{ birth_certificate.father.url_detail }}" title="{% trans 'clic here'|capfirst %}" 
                            {% if birth_certificate.father == birth_certificate.declarer %} 
                            class="text-lg underline underline-offset-2 {% if father_certificated %} cursor-pointer {% endif %}" 
                            {% else %} class="text-lg {% if father_certificated %} cursor-pointer {% endif %}" {% endif %}><b>{% if person.is_recognized %}⬇ {% endif %}{% trans 'father'|capfirst %} :</b> {{ birth_certificate.father.full_name }} ({{ birth_certificate.father.status }})</a>
                            {% if birth_certificate.father.birthday %}
                            <p class="text-sm ml-5"><b>{% trans 'birthday'|capfirst %} :</b> {{ birth_certificate.father.birthday|date:'d-m-Y' }}</p>
                            {% endif %}

                            {% if birth_certificate.father.address %}
                            <p class="text-sm ml-5"><b>{% trans 'address'|capfirst %} :</b> {{ birth_certificate.father.address }}</p>
                            {% endif %}

                            {% if birth_certificate.father.carreer %}
                            <p class="text-sm ml-5"><b>{% trans 'carreer'|capfirst %} :</b> {{ birth_certificate.father.carreer }}</p>
                            {% endif %}

                        </div>
                        {% endif %}
                        {% if birth_certificate.mother %}
                        <div class="flex flex-col">
                            <a 
                            href="{{ birth_certificate.mother.url_detail }}" title="{% trans 'clic here'|capfirst %}" 
                            {% if birth_certificate.mother == birth_certificate.declarer %} 
                            class="text-lg underline underline-offset-2 {% if mother_certificated %} cursor-pointer {% endif %}" 
                            {% else %}class="text-lg {% if mother_certificated %} cursor-pointer {% endif %}"{% endif %}><b>{% trans 'mother'|capfirst %} :</b> {{ birth_certificate.mother.full_name }} ({{ birth_certificate.mother.status }})</a>
                            {% if birth_certificate.mother.birthday %}
                            <p class="text-sm ml-5"><b>{% trans 'birthday'|capfirst %} :</b> {{ birth_certificate.mother.birthday|date:'d-m-Y' }}</p>
                            {% endif %}
                            {% if birth_certificate.mother.address %}
                            <p class="text-sm ml-5"><b>{% trans 'address'|capfirst %} :</b> {{ birth_certificate.mother.address }}</p>
                            {% endif %}
                            {% if birth_certificate.mother.carreer %}
                            <p class="text-sm ml-5"><b>{% trans 'carreer'|capfirst %} :</b> {{ birth_certificate.mother.carreer }}</p>
                            {% endif %}
                        </div>  
                        {% endif %}                  
                        {% if birth_certificate.father != birth_certificate.declarer and birth_certificate.mother != birth_certificate.declarer %}
                        <div class="flex flex-col">
                            <a 
                            href="{{ birth_certificate.declarer.url_detail }}" title="{% trans 'clic here'|capfirst %}" 
                            class="text-lg {% if declarer_certificated %} cursor-pointer {% endif %}"><b>{% trans 'declarer'|capfirst %} :</b> {{ birth_certificate.declarer.full_name }} ({{ birth_certificate.declarer.status }})</a>
                            {% if birth_certificate.declarer.birthday %}
                            <p class="text-sm ml-5"><b>{% trans 'birthday'|capfirst %} :</b> {{ birth_certificate.declarer.birthday|date:'d-m-Y' }}</p>
                            {% endif %}
                            {% if birth_certificate.declarer.address %}
                            <p class="text-sm ml-5"><b>{% trans 'address'|capfirst %} :</b> {{ birth_certificate.declarer.address }}</p>
                            {% endif %}
                            {% if birth_certificate.declarer.carreer %}
                            <p class="text-sm ml-5"><b>{% trans 'carreer'|capfirst %} :</b> {{ birth_certificate.declarer.carreer }}</p>
                            {% endif %}
                        </div>  
                        {% endif %}
                    </div>
                    <div>
                        {% if birth_certificate.date_declaration %}
                        <p><b>{% trans 'declaration date'|capfirst %} :</b> {{ birth_certificate.date_declaration|date:'d-m-Y H:i' }}</p>
                        {% endif %}
                        {% if birth_certificate.date_recognization and  birth_certificate.date_recognization != birth_certificate.date_register %}
                        <p><b>{% trans 'Recognization date'|capfirst %} :</b> {{ birth_certificate.date_recognization|date:'d-m-Y H:i' }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <div class="flex flex-col gap-4 justify-between whitespace-nowrap w-full">
            <div class="space-y-2 text-end">
                <p class="text-xl text-right tracking-widest"><b>PK :</b> {{ person.pk_str }}</p>
                {% if birth_certificate.date_register %}
                <p><b>{% trans 'register date'|capfirst %} :</b> {{ birth_certificate.date_register|date:'d-m-Y H:i' }}</p>
                {% endif %}
            </div>
            <div class="flex gap-x-7 justify-end whitespace-nowrap">
                <div class="flex justify-center items-center h-full">{{ age }}</div>
                <div class="flex justify-center items-center h-full">Not married</div>
                <div class="flex justify-center items-center h-full">{{ person.status|capfirst }}</div>
            </div>
        </div>
    </div>
    <div class="flex flex-col gap-7 rounded-b-3xl p-4 bg-white min-h-[500px]">
        <div class="flex justify-between gap-2">
            <p class="text-sm">Date created : {{ person.date_created|date:'d-m-Y H:i' }}</p>
            <p class="text-sm">Date modified : {{ person.date_modified|date:'d-m-Y H:i' }}</p>
        </div>
        <div class="flex flex-wrap justify-center gap-7">
            <a href="" class="flex items-center p-4 gap-4 rounded-xl shadow-md w-80">
                <div class="flex rounded-full min-w-16 min-h-16 items-center justify-center border-4 border-blue-500 text-xl font-semibold">
                    {{ birth_doc.count }}
                </div>
                <div class="flex flex-col">
                    <p class="text-md font-semibold">{% trans "Copies de Naissance"|upper %}</p>
                    <p class="text-blue-400"><b>N°</b> {{ birth_certificate.numero }}</p>
                    <p class="text-blue-400">{% trans 'last at'|capfirst %} {{ birth_doc.last.date_created|date:'d-m-Y H:i'|default:'0-0-0000 0:0' }}</p>
                </div>
            </a>
            {% if not person.is_alive %}
            <a href="" class="disabled:cursor-not-allowed flex items-center p-4 gap-4 rounded-xl shadow-md w-80">
                <div class="flex rounded-full min-w-16 min-h-16 items-center justify-center border-4 border-gray-500 text-xl font-semibold">
                    {{ death_doc.count }}
                </div>
                <div class="flex flex-col">
                    <p class="text-md font-semibold">{% trans "Copies de Décès"|upper %}</p>
                    <p class="text-gray-400"><b>N°</b> {{ death_certificate.numero }}</p>
                    <p class="text-gray-400">{% trans 'last at'|capfirst %} {{ death_doc.last.date_created|date:'d-m-Y H:i'|default:'0-0-0000 0:0' }}</p>
                </div>
            </a>
            {% endif %}
            <a href="" class="flex items-center p-4 gap-4 rounded-xl shadow-md w-80">
                <div class="flex rounded-full min-w-16 min-h-16 items-center justify-center border-4 border-rose-500 text-xl font-semibold">
                    {{ 0 }}
                </div>
                <div class="flex flex-col">
                    <p class="text-md font-semibold">{% trans "Copies de Mariage"|upper %}</p>
                    <p class="text-rose-400">{% trans 'last at ' %}</p>
                </div>
            </a>
        </div>

        <!-- Liste de Copies de Naissance -->
         <div class="container flex flex-wrap gap-4 py-4 max-h-80 overflow-auto">
            {% for doc in document %}
            <form method="get" action="{{ doc.get_absolute_url }}"
            class="w-fit shadow-md rounded-lg bg-white hover:bg-blue-50"
            title="{{ doc.date_created|date:'d-m-Y H:i' }} --- N° {{ doc.numero }} --- {{ doc.birth_type_str }} --- {{ doc.get_price|intcomma }} Ar --- x{{ doc.num_copy }} --- {{ doc.get_total_price|intcomma }} Ar"
            >
                <input type="hidden" name="client_detail" value="{{ doc.notes }}">
                <input type="hidden" name="many_cp" value="{{ doc.num_copy }}">
                <input type="hidden" name="type_cert" value="{{ doc.type_cert }}">
                <button class="p-4 space-x-2 whitespace-nowrap h-full">
                <span class="text-blue-400">{{ doc.date_created|date:"d-m-Y H:i" }} </span>
                --- N° {{ doc.numero }} --- {{ doc.type_str }} --- {{ doc.get_price|intcomma }} Ar --- x{{ doc.num_copy }} --- {{ doc.get_total_price|intcomma }} Ar
                <span class="px-2 py-1 text-xs rounded-full text-white
                {% if doc.status == 'V' %}
                bg-orange-400
                {% elif doc.status == 'D' %}
                bg-yellow-400
                {% endif %}
                ">{{ doc.status_str }}</span>
                </button>
            </form>
            {% endfor %}
         </div>

        <!-- Boutons d'Actions -->
         <div class="flex flex-col items-center fixed gap-2 rounded-xl bg-white shadow-md max-w-72 p-4 right-10 bottom-7 max-md:right-5 max-md:bottom-5 transform animate-out duration-300">
            <input type="checkbox" name="" id="show-action" class="hidden peer">
            <label for="show-action" class="hidden max-2xl:block peer-checked:hidden text-3xl font-extralight px-2 rounded-lg cursor-pointer w-full h-full text-center">+</label>
            <a class="hidden max-2xl:hidden peer-checked:block px-4 py-2 border border-white text-white shadow-md bg-gray-300 rounded-lg w-full text-center cursor-not-allowed"
            title="En construction"
            >
                {% translate "Arbre de Famille" %}
            </a>
            <a class="hidden max-2xl:hidden peer-checked:block px-4 py-2 border border-white text-white shadow-md bg-gray-300 rounded-lg w-full text-center cursor-not-allowed"
            title="En construction"
            >
                {% translate "Arbre Généalogique" %}
            </a>
            <form action="{{ person.url_preview }}" method="get" class="max-2xl:hidden peer-checked:flex flex flex-col gap-1">
                <div class="flex flex-wrap gap-x-2 justify-center">
                    <button type="button" onclick="downManyCp()" class="px-4 text-xl bg-gray-100 rounded-lg">-</button>
                    <input id="id_many_cp" name="many_cp" type="number" value=1 min=1 max=10 class="text-end w-16 focus:ring-0 border-0 border-b-2">
                    <button type="button" onclick="upManyCp()" class="px-4 text-xl bg-gray-100 rounded-lg">+</button>
                    <div class="flex w-full">
                        <select name="client_gender" id="id-client-gender" class="border-0 border-b-2 focus:ring-0">
                            <option value="M">{% translate "Mr" %}</option>
                            <option value="F">{% translate "Mrs" %}</option>
                        </select>
                        <input type="text" name="client_detail" id="id-client-field"
                        placeholder="{% translate 'About the client' %}"
                        class="w-full border-0 border-b-2 focus:ring-0">
                    </div>
                </div>
                {% if person.have_birth %}
                <button name="type_cert" value="birth" class="px-4 py-2 border border-white text-white shadow-md bg-green-600 hover:bg-green-500 rounded-lg w-full text-center cursor-pointer"
                title="{% translate 'Make Cp. Birth' %}"
                >
                    {% translate "Make Cp. Birth" %}
                </button>
                {% endif %}
                {% if person.have_death %}
                <button name="type_cert" value="death" class="px-4 py-2 border border-white text-white shadow-md bg-green-600 hover:bg-green-500 rounded-lg w-full text-center cursor-pointer"
                title="{% translate 'Make Cp. Death' %}"
                >
                    {% translate "Make Cp. Death" %}
                </button>
                {% endif %}
                {% if person.is_married %}
                <a href="" class="px-4 py-2 border border-white text-white shadow-md bg-green-600 hover:bg-green-500 rounded-lg w-full text-center cursor-pointer"
                title="{% translate 'Make Cp. Marriage' %}"
                >
                    {% translate "Make Cp. Marriage" %}
                </a>
                {% endif %}
            </form>
            <div class="max-2xl:hidden peer-checked:flex flex flex-col w-full gap-1">
                {% if not person.have_birth %}
                <form method='post' action="{% url 'civil:birth-register' %}">
                    {% csrf_token %}
                    <button name="person_pk" value="{{ person.pk }}" class="px-4 py-2 border border-white text-white shadow-md bg-yellow-500 hover:bg-yellow-400 rounded-lg w-full text-center cursor-pointer"
                    title="{% translate 'Birth Certificate' %}"
                    >
                    {% translate "Birth Certificate" %}
                    </button>
                </form>
                {% endif %}
                {% if not person.have_death %}
                <form method='post' action="{% url 'civil:death-register' %}">
                    {% csrf_token %}
                    <button name="person_pk" value="{{ person.pk }}" class="px-4 py-2 border border-white text-white shadow-md bg-yellow-500 hover:bg-yellow-400 rounded-lg w-full text-center cursor-pointer"
                    title="{% translate 'Death Certificate' %}"
                    >
                    {% translate "Death Certificate" %}
                    </button>
                </form>
                {% endif %}
                {% if not person.is_married %}
                <a href="" class="px-4 py-2 border border-white text-white shadow-md bg-yellow-500 hover:bg-yellow-400 rounded-lg w-full text-center cursor-pointer"
                title="{% translate 'Marriage Certificate' %}"
                >
                    {% translate "Marriage Certificate" %}
                </a>
                {% endif %}
                {% if not birth_certificate.date_recognization %}
                <form method='post' action="{% url 'civil:birth-register' %}">
                    {% csrf_token %}
                    <button name="cert_pk" value="{{ birth_certificate.pk }}" class="px-4 py-2 border border-white text-white shadow-md bg-yellow-500 hover:bg-yellow-400 rounded-lg w-full text-center cursor-pointer"
                    title="{% translate 'Recognize' %}"
                    >
                        {% translate "Recognize" %}
                    </button>
                </form>
                {% endif %}
            </div>
            <a href="{{ person.url_modify }}" class="max-2xl:hidden peer-checked:block px-4 py-2 border border-white text-white shadow-md bg-blue-600 hover:bg-blue-500 rounded-lg w-full text-center cursor-pointer"
            title="{% translate 'Modify' %}"
            >
                {% translate "Modify" %}
            </a>
            <button type="button" onclick="supprimCertificate()" class="max-2xl:hidden peer-checked:block px-4 py-2 border border-white text-white shadow-md bg-rose-600 hover:bg-rose-500 rounded-lg w-full text-center cursor-pointer"
            title="{% translate 'Delete' %}"
            >
                {% translate "Delete" %}
            </button>
            <a onclick="history.back()" class="max-2xl:hidden peer-checked:block px-4 py-2 border border-white text-white shadow-md bg-gray-600 hover:bg-gray-500 rounded-lg w-full text-center cursor-pointer"
            title="{% translate 'Back' %}"
            >
                {% translate "Back" %}
            </a>
         </div>
    </div>
</div>

<script>
    function downManyCp() {
        if ($('#id_many_cp').val() > 1) {
            $('#id_many_cp').val(Number($('#id_many_cp').val()) - 1);
        }
    }

    function upManyCp() {
        if ($('#id_many_cp').val() < 10) {
            $('#id_many_cp').val(Number($('#id_many_cp').val()) + 1);
        }
    }
    function supprimCertificate(){
        if (confirm('{% trans "Are you sure you want to delete this birth_certificate ? This action will delete all documents that attached to it." %}')) {
            document.location.assign("{% url 'civil:birth-delete' 1 %}".replace('1', Number.parseInt('{{ birth_certificate.pk|safe }}')));
        }
    }
</script>

{% endblock article %}
